function ibs_util_19(){return"AIzaSyBwcmfwl7W1aMyo9wnXwmASRfZ0sOhGhRc"}function IsEmail(a){return/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(a)}function CalendarObj(a,b,h){this.init(b,h)}
(function(a){CalendarObj.prototype.init=function(b,h){var d=this;this.args=b;this.mode=h;this.id=b.id;this.calendar=a("#fullcalendar-"+this.id);this.options={id:"1",feeds:{},ajaxUrl:null,ajaxData:null};for(var p in b)"undefined"!==typeof this.options[p]&&(this.options[p]=b[p]);this.qtip_params=function(c){var a=d.fullcalendar_options.timeFormat,m=b.qtip.title.replace("%title%",c.title),f="";"undefined"!==typeof c.location&&""!==c.location&&(f=b.qtip.location.replace("%location%",c.location));var u=
"";"undefined"!==typeof c.description&&""!==c.description&&(u=b.qtip.description.replace("%description%",c.description));var r="",r=moment(c.start).format("ddd MMM DD "+a)+moment(c.end).format(" - "+a);c.allDay&&(r=moment(c.start).format("ddd MMM DD")+"  All day");r=b.qtip.time.replace("%time%",r);return{content:{text:b.qtip.order.replace("%title%",m).replace("%location%",f).replace("%description%",u).replace("%time%",r)},position:{my:"bottom center",at:"top center"},style:{classes:b.qtip.style+" "+
b.qtip.rounded+b.qtip.shadow},show:{event:"mouseover"},hide:{fixed:!0,delay:250,event:"mouseout mouseleave"}}};this.fullcalendar_options={timezone:"local",height:null,theme:!0,firstDay:"1",weekends:!0,lang:"en_us",timeFormat:"hh:mm a",titleFormat:"YYYY MMM DD",dayNamesShort:"Sun Mon Tue Wed Thu Fri Sat".split(" "),defaultView:"month",eventLimit:6,eventLimitClick:"popover",aspectRatio:1,editable:!1,hiddenDays:"",fixedWeekCount:!0,weekNumbers:!1,defaultDate:moment()};for(p in b)"undefined"!==typeof this.fullcalendar_options[p]&&
""!==b[p]&&(this.fullcalendar_options[p]=b[p]);this.fullcalendar_options.header={left:b.headerLeft,center:b.headerCenter,right:b.headerRight};this.fullcalendar_options.loading=function(c){if(c&&"widget"!==h){c=a("#fullcalendar-"+d.options.id).position();var e=a("#fullcalendar-"+d.options.id).width(),b=a("#fullcalendar-"+d.options.id).height();a("#ibs-loading-"+d.options.id).css({left:c.left,top:c.top,width:e,height:b}).show()}else a("#ibs-loading-"+d.options.id).hide()};this.fullcalendar_options.eventRender=
function(c,a,m){("widget"===h||b.hideTitle)&&a.css("color",a.css("background-color"));a.css("cursor","pointer");"admin"===h&&"month"!==m.name||a.qtip(d.qtip_params(c))};this.fullcalendar_options.eventClick=function(a,d,b){return a.source.nolink?!1:""!==a.source.altlink?(a=a.source.altlink.replace("%id%",a.id),window.open(a),!1):a.url?(window.open(a.url),!1):!0};this.fullcalendar_options.dayClick=function(a,d,b){};this.fullcalendar_options.eventAfterAllRender=function(c){if("none"!==b.event_list&&
a("#list-display-"+d.id).is(":checked")){c="#event-table-"+d.id;var e=a("#fullcalendar-"+d.id).fullCalendar("clientEvents");e.sort(function(a,c){return moment(a.start)-moment(c.start)});var m=[];if(!1===b.list_past||!1===b.list_repeat){for(var f=0;f<e.length;f++)if("string"!==typeof e[f].repeat||null===e[f].repeat||""===e[f].repeat||!1!==b.list_repeat)!1===b.list_past&&moment()>moment(e[f].start)||m.push(e[f]);e=m}e=e.slice(0,b.list_max);a(c).empty();if("widget"!==h)for(a(c).css({border:"1px solid silver"}).append(a("<tbody>").append(a("<tr>").addClass("ui-widget-header").append(a("<th>").text("Day").css("padding",
"3px")).append(a("<th>").text("Time").css("padding","3px")).append(a("<th>").text("Event").css("padding","3px")).append(a("<th>").text("Location").css("padding","3px")))),f=0;f<e.length;f++){var m=moment()>moment(e[f].start)?"*":"",u=moment(e[f].start).format("ddd Do"),r=moment(e[f].start).format(d.fullcalendar_options.timeFormat);a(c).find("tbody").append(a("<tr>").attr({disabled:m}).append(a("<td>").text(u).css("padding","3px")).append(a("<td>").text(r).css("padding","3px")).append(a("<td>").append(a("<a>").attr({href:e[f].url,
target:"_blank"}).html(m+e[f].title))).append(a("<td>").text(e[f].location).css("padding","3px")))}else for(a(c).css({border:"1px solid silver"}).append(a("<tbody>").append(a("<tr>").addClass("ui-widget-header").append(a("<th>").text("Events").css("padding","3px")))),f=0;f<e.length;f++)m=moment()>moment(e[f].start)?"*":"",a(c).find("tbody").append(a("<tr>").qtip(d.qtip_params(e[f])).append(a("<td>").append(a("<a>").attr({href:e[f].url,target:"_blank"}).html(m+e[f].title))))}};this.renderCalendar=
function(){"none"===b.event_list?a("#list-display-"+d.id).parent().css("display","none"):a("#list-display-"+d.id).prop("checked","show"===b.event_list);b.legend&&a("#legend-list-"+d.id).css("display","block");this.calendar.fullCalendar(this.fullcalendar_options);for(var c in this.options.feeds)if(""!==this.options.feeds[c].url&&this.options.feeds[c].enabled){var e={googleCalendarApiKey:function(){return"string"===typeof d.options.feeds[c].key&&""!==d.options.feeds[c].key?d.options.feeds[c].key:ibs_util_19()},
nolink:this.options.feeds[c].nolink,altlink:this.options.feeds[c].altlink,feedName:this.options.feeds[c].name,textColor:this.options.feeds[c].textColor,backgroundColor:this.options.feeds[c].backgroundColor,url:this.options.feeds[c].url,googleCalendarId:IsEmail(this.options.feeds[c].url)?this.options.feeds[c].url:null};this.calendar.fullCalendar("addEventSource",e);a("#legend-list-"+d.id).append(a("<span>").addClass("ibs-legend-color").css({"background-color":this.options.feeds[c].backgroundColor})).append(a("<span>").addClass("ibs-legend-name").text(this.options.feeds[c].name))}b.ibsEvents&&
this.calendar.fullCalendar("addEventSource",{events:function(a,c,b,e){b=[];for(var p in d.ibs_events){var g=d.ibs_events[p];if(0==g.recurr){var k,l,h,t;k=a.unix();l=c.unix();h=moment(g.start).unix();t=moment(g.end).unix();(h>=k&&t<=l||t>k&&t<l||h>=k&&h<=l||k>=h&&l<=t)&&b.push(g)}else{k=[];if(g.exceptions){k=g.exceptions.split(",");for(var n in k)k[n]=moment(k[n]).startOf("day")}l=(new RRule(RRule.parseString(g.repeat))).between(a.toDate(),c.toDate());for(n in l)l[n]=moment(l[n]).startOf("day");h=
moment(g.end).diff(moment(g.start),"seconds");t=moment(g.start).unix()-moment(g.start).startOf("day").unix();for(n in l){var q;a:{q=n;var v=void 0;for(v in k)if(0===k[v].diff(l[q])){q=!0;break a}q=!1}q||(q=l[n].startOf("day"),q={start:q.add(t,"seconds").format(),end:q.add(h,"seconds").format(),id:g.id,title:g.title,allDay:g.allDay,color:g.color,textColor:g.textColor,description:g.description,url:g.url,repeat:g.repeat,exceptions:g.exceptions},b.push(q))}}for(n in b)b[n].textColor="#ffffff",b[n].editable=
!1}e(b)}});"none"!==b.event_list?("show"===b.event_list&&a("#event-list-"+d.id).show(),a("#list-display-"+d.id).click(function(c){a("#list-display-"+d.id).is(":checked")?(a("#fullcalendar-"+d.id).fullCalendar("rerenderEvents"),a("#event-list-"+d.id).show()):a("#event-list-"+d.id).hide()})):a("#list-display-div-"+d.id).hide()};b.ibsEvents?a.get(d.options.ajaxUrl,{action:"ibs_calendar_get_events",cache:!1,dataType:"json"}).then(function(a){if(""!==a){a=decodeURIComponent(a);d.ibs_events=JSON.parse(a);
for(var b in d.ibs_events)d.ibs_events[b].title=jQuery("<div>").html(d.ibs_events[b].title).text(),d.ibs_events[b].description=jQuery("<div>").html(d.ibs_events[b].description).text(),d.ibs_events[b].editable=!1,d.ibs_events[b].start=moment.unix(parseInt(d.ibs_events[b].start)).format(),d.ibs_events[b].end=moment.unix(parseInt(d.ibs_events[b].end)).format();console.log("IBS Events loaded.")}else d.ibs_events=[];d.renderCalendar()},function(){console.log("Get IBS Events failed.")}):d.renderCalendar()}})(jQuery);
