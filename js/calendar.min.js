function ibs_util_19(){return"AIzaSyBwcmfwl7W1aMyo9wnXwmASRfZ0sOhGhRc"}function IsEmail(e){var t=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;return t.test(e)}function CalendarObj(e,t,i){this.init(t,i)}!function(e){CalendarObj.prototype.init=function(t,i){var n=this;this.args=t,this.mode=i,this.id=t.id,this.calendar=e("#fullcalendar-"+this.id),this.options={id:"1",feeds:{},ajaxUrl:null,ajaxData:null};for(var a in t)"undefined"!=typeof this.options[a]&&(this.options[a]=t[a]);this.qtip_params=function(e){var i=n.fullcalendar_options.timeFormat,a=t.qtip.title.replace("%title%",e.title),s="";"undefined"!=typeof e.location&&""!==e.location&&(s=t.qtip.location.replace("%location%",e.location));var o="";"undefined"!=typeof e.description&&""!==e.description&&(t.qtip.linkify?(console.log(linkifyHtml(e.description,{defaultProtocol:"https"})),o=t.qtip.description.replace("%description%",linkifyHtml(e.description,{defaultProtocol:"https"}))):o=t.qtip.description.replace("%description%",e.description));var d="";d=moment(e.start).format("ddd MMM DD "+i)+moment(e.end).format(" - "+i),e.allDay&&(d=moment(e.start).format("ddd MMM DD")+"  All day"),d=t.qtip.time.replace("%time%",d);var l=t.qtip.order.replace("%title%",a).replace("%location%",s).replace("%description%",o).replace("%time%",d);return{content:{text:l},position:{my:"bottom center",at:"top center"},style:{classes:t.qtip.style+" "+t.qtip.rounded+t.qtip.shadow},show:{event:"mouseover"},hide:{fixed:!0,delay:250,event:"mouseout mouseleave"}}},this.fullcalendar_options={timezone:"local",height:null,theme:!0,firstDay:"1",weekends:!0,lang:"en_us",timeFormat:"hh:mm a",titleFormat:"YYYY MMM DD",dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],defaultView:"month",eventLimit:6,eventLimitClick:"popover",aspectRatio:1,editable:!1,hiddenDays:"",fixedWeekCount:!0,weekNumbers:!1,defaultDate:moment()};for(var a in t)"undefined"!=typeof this.fullcalendar_options[a]&&""!==t[a]&&(this.fullcalendar_options[a]=t[a]);this.fullcalendar_options.header={left:t.headerLeft,center:t.headerCenter,right:t.headerRight},this.fullcalendar_options.loading=function(t){if(t&&"widget"!==i){var a=e("#fullcalendar-"+n.options.id).position(),s=e("#fullcalendar-"+n.options.id).width(),o=e("#fullcalendar-"+n.options.id).height();e("#ibs-loading-"+n.options.id).css({left:a.left,top:a.top,width:s,height:o}).show()}else e("#ibs-loading-"+n.options.id).hide()},this.fullcalendar_options.eventRender=function(e,a,s){("widget"===i||t.hideTitle)&&a.css("color",a.css("background-color")),a.css("cursor","pointer"),("admin"!==i||"month"===s.name)&&a.qtip(n.qtip_params(e))},this.fullcalendar_options.eventClick=function(e,t,i){if(e.source.nolink)return!1;if(""!==e.source.altlink){var n=e.source.altlink.replace("%id%",e.id);return window.open(n),!1}return e.url?(window.open(e.url),!1):!0},this.fullcalendar_options.dayClick=function(e,t,i){},this.fullcalendar_options.eventAfterAllRender=function(a){if("none"!==t.event_list&&e("#list-display-"+n.id).is(":checked")){var s="#event-table-"+n.id,o="#fullcalendar-"+n.id,d=e(o).fullCalendar("clientEvents");d.sort(function(e,t){return moment(e.start)-moment(t.start)});var l=[];if(t.list_past===!1||t.list_repeat===!1){for(var r=0;r<d.length;r++)("string"!=typeof d[r].repeat||null===d[r].repeat||""===d[r].repeat||t.list_repeat!==!1)&&(t.list_past===!1&&moment()>moment(d[r].start)||l.push(d[r]));d=l}if(d=d.slice(0,t.list_max),e(s).empty(),"widget"!==i){e(s).css({border:"1px solid silver"}).append(e("<tbody>").append(e("<tr>").addClass("ui-widget-header").append(e("<th>").text("Day").css("padding","3px")).append(e("<th>").text("Time").css("padding","3px")).append(e("<th>").text("Event").css("padding","3px")).append(e("<th>").text("Location").css("padding","3px"))));for(var r=0;r<d.length;r++){var p="ddd Do",c=moment()>moment(d[r].start)?"*":"",f=moment(d[r].start).format(p),u=moment(d[r].start).format(n.fullcalendar_options.timeFormat);e(s).find("tbody").append(e("<tr>").attr({disabled:c}).append(e("<td>").text(f).css("padding","3px")).append(e("<td>").text(u).css("padding","3px")).append(e("<td>").append(e("<a>").attr({href:d[r].url,target:"_blank"}).html(c+d[r].title))).append(e("<td>").text(d[r].location).css("padding","3px")))}}else{e(s).css({border:"1px solid silver"}).append(e("<tbody>").append(e("<tr>").addClass("ui-widget-header").append(e("<th>").text("Events").css("padding","3px"))));for(var r=0;r<d.length;r++)c=moment()>moment(d[r].start)?"*":"",e(s).find("tbody").append(e("<tr>").qtip(n.qtip_params(d[r])).append(e("<td>").append(e("<a>").attr({href:d[r].url,target:"_blank"}).html(c+d[r].title))))}}},this.renderCalendar=function(){"none"===t.event_list?e("#list-display-"+n.id).parent().css("display","none"):e("#list-display-"+n.id).prop("checked","show"===t.event_list),t.legend&&e("#legend-list-"+n.id).css("display","block"),this.calendar.fullCalendar(this.fullcalendar_options);for(var i in this.options.feeds)if(""!==this.options.feeds[i].url&&this.options.feeds[i].enabled){var a={googleCalendarApiKey:function(){return"string"==typeof n.options.feeds[i].key&&""!==n.options.feeds[i].key?n.options.feeds[i].key:ibs_util_19()},nolink:this.options.feeds[i].nolink,altlink:this.options.feeds[i].altlink,feedName:this.options.feeds[i].name,textColor:this.options.feeds[i].textColor,backgroundColor:this.options.feeds[i].backgroundColor,url:this.options.feeds[i].url,googleCalendarId:IsEmail(this.options.feeds[i].url)?this.options.feeds[i].url:null};this.calendar.fullCalendar("addEventSource",a),e("#legend-list-"+n.id).append(e("<span>").addClass("ibs-legend-color").css({"background-color":this.options.feeds[i].backgroundColor})).append(e("<span>").addClass("ibs-legend-name").text(this.options.feeds[i].name))}t.ibsEvents&&this.calendar.fullCalendar("addEventSource",{events:function(e,t,i,a){var s=[];for(var o in n.ibs_events){var d=n.ibs_events[o];if(0==d.recurr){var l,r,p,c;l=e.unix(),r=t.unix(),p=moment(d.start).unix(),c=moment(d.end).unix(),(p>=l&&r>=c||c>l&&r>c||p>=l&&r>=p||l>=p&&c>=r)&&s.push(d)}else{var f=[];if(d.exceptions){f=d.exceptions.split(",");for(var u in f)f[u]=moment(f[u]).startOf("day")}var m=new RRule(RRule.parseString(d.repeat)),h=m.between(e.toDate(),t.toDate());for(u in h)h[u]=moment(h[u]).startOf("day");var v=function(e){for(var t in f)if(0===f[t].diff(h[e]))return!0;return!1},g=moment(d.end).diff(moment(d.start),"seconds"),y=moment(d.start).unix()-moment(d.start).startOf("day").unix();for(var u in h)if(!v(u)){var _=h[u].startOf("day"),b={start:_.add(y,"seconds").format(),end:_.add(g,"seconds").format(),id:d.id,title:d.title,allDay:d.allDay,color:d.color,textColor:d.textColor,description:d.description,url:d.url,repeat:d.repeat,exceptions:d.exceptions};s.push(b)}}for(var u in s)s[u].textColor="#ffffff",s[u].editable=!1}a(s)}}),"none"!==t.event_list?("show"===t.event_list&&e("#event-list-"+n.id).show(),e("#list-display-"+n.id).click(function(t){e("#list-display-"+n.id).is(":checked")?(e("#fullcalendar-"+n.id).fullCalendar("rerenderEvents"),e("#event-list-"+n.id).show()):e("#event-list-"+n.id).hide()})):e("#list-display-div-"+n.id).hide()},t.ibsEvents?e.get(n.options.ajaxUrl,{action:"ibs_calendar_get_events",cache:!1,dataType:"json"}).then(function(e){if(""!==e){e=decodeURIComponent(e),n.ibs_events=JSON.parse(e);for(var t in n.ibs_events)n.ibs_events[t].title=jQuery("<div>").html(n.ibs_events[t].title).text(),n.ibs_events[t].description=jQuery("<div>").html(n.ibs_events[t].description).text(),n.ibs_events[t].editable=!1,n.ibs_events[t].start=moment.unix(parseInt(n.ibs_events[t].start)).format(),n.ibs_events[t].end=moment.unix(parseInt(n.ibs_events[t].end)).format();console.log("IBS Events loaded.")}else n.ibs_events=[];n.renderCalendar()},function(){console.log("Get IBS Events failed.")}):n.renderCalendar()}}(jQuery);